<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="kr">
  <!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>음식점 정보 조회</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Free HTML5 Website Template by FreeHTML5.co"
    />
    <meta
      name="keywords"
      content="free html5, free template, free bootstrap, free website template, html5, css3, mobile first, responsive"
    />
    <meta name="author" content="FreeHTML5.co" />

    <!-- 
	//////////////////////////////////////////////////////

	FREE HTML5 TEMPLATE 
	DESIGNED & DEVELOPED by FreeHTML5.co
		
	Website: 		http://freehtml5.co/
	Email: 			info@freehtml5.co
	Twitter: 		http://twitter.com/fh5co
	Facebook: 		https://www.facebook.com/fh5co

	//////////////////////////////////////////////////////
	-->

    <!-- Facebook and Twitter integration -->
    <meta property="og:title" content="" />
    <meta property="og:image" content="" />
    <meta property="og:url" content="" />
    <meta property="og:site_name" content="" />
    <meta property="og:description" content="" />
    <meta name="twitter:title" content="" />
    <meta name="twitter:image" content="" />
    <meta name="twitter:url" content="" />
    <meta name="twitter:card" content="" />

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="shortcut icon" href="favicon.ico" />

    <link
      href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700"
      rel="stylesheet"
    />
    <!-- Naver Web Font -->
    <link
      href="https://hangeul.pstatic.net/hangeul_static/css/nanum-barun-gothic.css"
      rel="stylesheet"
    />

    <!-- Animate.css -->
    <link rel="stylesheet" href="../../css/animate.css" />
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="../../css/icomoon.css" />
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="../../css/bootstrap.css" />
    <!-- Flexslider  -->
    <link rel="stylesheet" href="../../css/flexslider.css" />
    <!-- Theme style  -->
    <link rel="stylesheet" href="../../css/style.css" />
    <!-- 이 파일의 style -->
    <link rel="stylesheet" href="./list.css" />

    <!-- jQuery -->
    <script src="../../js/jquery.min.js"></script>
    <!-- jQuery Easing -->
    <script src="../../js/jquery.easing.1.3.js"></script>
    <!-- Bootstrap -->
    <script src="../../js/bootstrap.min.js"></script>
    <!-- Waypoints -->
    <script src="../../js/jquery.waypoints.min.js"></script>
    <!-- Flexslider -->
    <script src="../../js/jquery.flexslider-min.js"></script>

    <!-- MAIN JS -->
    <script src="../../js/main.js"></script>

    <!-- Modernizr JS -->
    <script src="../../js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
	<script src="js/respond.min.js"></s>
	<![endif]-->

    <!-- 
    contentTypeId : 관광타입
      39 : 음식점
    areaCode : 광역시/도
      1 : 서울
      2 : 인천
      3 : 대전
      4 : 대구
      5 : 광주
      6 : 부산
      7 : 울산
      8 : 세종특별자치시
      9 : 경기도
      10 : 강원특별자치도
      11 : 충청북도
      12 : 충청남도
      13 : 경상북도
      14 : 경상남도
      15 : 전라북도
      16 : 전라남도
      17 : 제주도
    sigunguCode : 시/군/구
      areaCode를 기준으로 하단에 표시된 api를 통해 얻어올 수 있음
      1 : 서울 : 25개
      2 : 인천 : 10개
      3 : 대전 : 5개
      4 : 대구 : 9개
      5 : 광주 : 5개
      6 : 부산 : 16개
      7 : 울산 : 5개
      8 : 세종특별자치시 : 1개
      9 : 경기도 : 없음
      10 : 강원특별자치도 : 없음
      11 : 충청북도 : 없음
      12 : 충청남도 : 없음
      13 : 경상북도 : 없음
      14 : 경상남도 : 없음
      15 : 전라북도 : 없음
      16 : 전라남도 : 없음
      17 : 제주도 : 없음
    cat1 : 대분류 코드
      A05 : 음식
    cat2 : 중분류 코드
      A0502 : 음식점
    cat3 : 소분류 코드
      A05020100 : 한식
      A05020200 : 서양식
      A05020300 : 일식
      A05020400 : 중식
      A05020700 : 이색음식점
      A05020900 : 카페/전통찻집
      A05021000 : 클럽
  	 -->
    <!-- 
		음식점 소분류 코드 받아오는 api url
		http://apis.data.go.kr/B551011/KorService1/categoryCode1?ServiceKey=EmPrDl5kZrOzoYiaEQ1J%2BrysQf8dbws8ZMv4KCelNelSrm4hGQfxXmg2X6jumQex%2FRK72yCvA5fNzAs%2F9LFkpQ%3D%3D&cat1=A05&cat2=A0502&numOfRows=17&pageNo=1&MobileOS=ETC&MobileApp=AppTest
  	지역코드(광역시/시) : areaCode 받아오는 api url
		http://apis.data.go.kr/B551011/KorService1/areaCode1?ServiceKey=(***API KEY***)&numOfRows=17&pageNo=1&MobileOS=ETC&MobileApp=AppTest
		지역코드(시/군/구) : 넘겨준 areaCode(광역시/시 값) 기반으로 sigunguCode 받아오는 api url
		http://apis.data.go.kr/B551011/KorService1/areaCode1?ServiceKey=(***API KEY***)&areaCode=(***광역시/시 코드***)&numOfRows=25&pageNo=1&MobileOS=ETC&MobileApp=AppTest
		-->

    <script>
      let pageNo = 1;
      let numOfRows = 12;
      let totalCount = 0;
      let selectedCategory = ""; // default : 전체
      $(function () {
        $(".loading-indicator").hide();

        getRestaurantsList(pageNo, selectedCategory);

        // $(".more").click(function () {
        //   $(this).remove();
        //   pageNo++;
        //   getRestaurantsList(pageNo, selectedCategory);
        // });
        $("#cat3").change(function () {
          selectedCategory = $(this).val();
        });
        $("#search").click(function () {
          $(".items").data("animateEffect", "fadeInLeft");
          $(".wrapper-restaurants-list").html("");
          getRestaurantsList(pageNo, selectedCategory);
        });
      });

      function getRestaurantsList(pageNo, selectedCategory) {
        console.log(pageNo, selectedCategory);
        $(".loading-indicator").show();

        const apiKey =
          "EmPrDl5kZrOzoYiaEQ1J%2BrysQf8dbws8ZMv4KCelNelSrm4hGQfxXmg2X6jumQex%2FRK72yCvA5fNzAs%2F9LFkpQ%3D%3D";
        const url = `http://apis.data.go.kr/B551011/KorService1/areaBasedList1?numOfRows=${numOfRows}&pageNo=${pageNo}&MobileOS=ETC&MobileApp=AppTest&ServiceKey=${apiKey}&listYN=Y&arrange=A&contentTypeId=39&areaCode=&sigunguCode=&cat1=A05&cat2=A0502&cat3=${selectedCategory}&_type=json`;
        $.ajax({
          url: url, // 데이터를 수신 받을 서버 주소
          type: "get", // 통신방식(GET, POST, PUT, DELETE)
          dataType: "json", // 수신 받을 데이터 타입
          async: false,
          success: function (data) {
            // 통신이 성공했을 때 호출되는 콜백함수
            console.log(data);
            parsingData(data);
          },
          err: function () {
            // 통신이 실패(부정적인 response) 했을 때 호출되는 콜백함수
          },
          complete: function () {
            // 통신이 완료되었을 때 호출 되는 콜백함수
            $(".loading-indicator").hide();
          },
        });

        function parsingData(restaurantsData) {
          const restaurantsArr = restaurantsData.response.body.items.item;
          console.log(restaurantsArr);

          totalCount = restaurantsData.response.body.totalCount;
          $.each(restaurantsArr, function (i, item) {
            const contentId = item.contentid;

            let output = `<div class="items col-md-3 col-sm-6 col-padding animate-box" data-animate-effect="fadeInLeft">`;
            output += `<div class="blog-entry">`;
            output += `<a href="#" class="blog-img">`;
            output += `<img src="${
              item.firstimage != ""
                ? item.firstimage
                : item.firstimage2 != ""
                ? item.firstimage2
                : "../../images/noimage_restaurants.png"
            }" class="img-responsive" alt="Free HTML5 Bootstrap Template by FreeHTML5.co" /></a>`;
            output += `<div class="desc">`;
            output += `<h3><a href="#" title="${item.title}">${item.title}</a></h3>`;
            output += `<p>${item.addr1}${
              item.addr2 != "" ? " " + item.addr2 : ""
            }</p>`;
            output += `<span><small>등록일 : ${stringToDate(
              item.createdtime
            )}</small><br>`;
            output += `<small>수정일 : ${stringToDate(
              item.modifiedtime
            )}</small></span>`;
            output += `<a href="#" class="lead">자세히 보기 <i class="icon-arrow-right3"></i></a>`;
            output += `</div>`;
            output += `</div>`;
            output += `</div>`;
            $(".wrapper-restaurants-list").append(output);
            $("#totalCount").html(
              `총 ${totalCount}건의 정보가 조회되었습니다.`
            );
            contentWayPoint();

            function contentWayPoint() {
              var i = 0;
              $(".animate-box").waypoint(
                function (direction) {
                  if (
                    direction === "down" &&
                    !$(this.element).hasClass("animated")
                  ) {
                    i++;

                    $(this.element).addClass("item-animate");
                    setTimeout(function () {
                      $("body .animate-box.item-animate").each(function (k) {
                        var el = $(this);
                        setTimeout(
                          function () {
                            var effect = el.data("animate-effect");
                            if (effect === "fadeIn") {
                              el.addClass("fadeIn animated");
                            } else if (effect === "fadeInLeft") {
                              el.addClass("fadeInLeft animated");
                            } else if (effect === "fadeInRight") {
                              el.addClass("fadeInRight animated");
                            } else {
                              el.addClass("fadeInUp animated");
                            }

                            el.removeClass("item-animate");
                          },
                          k * 200,
                          "easeInOutExpo"
                        );
                      });
                    }, 100);
                  }
                },
                { offset: "85%" }
              );
            }
          });
        }
      }
      function stringToDate(str) {
        let year = str.substr(0, 4);
        let month = str.substr(4, 2);
        let date = str.substr(6, 2);
        let hour = str.substr(8, 2);
        let minute = str.substr(10, 2);
        let second = str.substr(12, 2);
        // console.log(year, month, date, hour, minute, second)
        return `${year}년 ${month}월 ${date}일 ${hour}:${minute}:${second}`;
      }
    </script>
  </head>
  <body>
    <div id="fh5co-page">
      <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
      <aside id="fh5co-aside" role="complementary" class="border js-fullheight">
        <h1 id="fh5co-logo"><a href="../../index.html">Goott Tour</a></h1>
        <nav id="fh5co-main-menu" role="navigation">
          <ul>
            <li><a href="index.html">Home</a></li>
            <li class="fh5co-active"><a href="list.html">Restaurants</a></li>
            <li><a href="#">Noname</a></li>
            <li><a href="#">Noname</a></li>
            <li><a href="#">Noname</a></li>
          </ul>
        </nav>

        <div class="fh5co-footer">
          <p>
            <small
              ><span>&copy; 2016 Blend Free HTML5. All Rights Reserved.</span>
              <span
                >Designed by
                <a href="http://freehtml5.co/" target="_blank">FreeHTML5.co</a>
              </span>
              <span
                >Demo Images:
                <a href="https://unsplash.com/" target="_blank"
                  >Unsplash</a
                ></span
              ></small
            >
          </p>
          <ul>
            <li>
              <a href="#"><i class="icon-facebook2"></i></a>
            </li>
            <li>
              <a href="#"><i class="icon-twitter2"></i></a>
            </li>
            <li>
              <a href="#"><i class="icon-instagram"></i></a>
            </li>
            <li>
              <a href="#"><i class="icon-linkedin2"></i></a>
            </li>
          </ul>
        </div>
      </aside>

      <div id="fh5co-main">
        <div class="fh5co-narrow-content">
          <h2
            class="fh5co-heading animate-box"
            data-animate-effect="fadeInLeft"
          >
            Read Our Blog
          </h2>
          <div
            class="wrapper-category animate-box"
            data-animate-effect="fadeInLeft"
          >
            <select name="cat3" id="cat3">
              <option value="">전체</option>
              <option value="A05020100">한식</option>
              <option value="A05020200">서양식</option>
              <option value="A05020300">일식</option>
              <option value="A05020400">중식</option>
              <option value="A05020700">이색음식점</option>
              <option value="A05020900">카페/전통찻집</option>
              <option value="A05021000">클럽</option>
            </select>
            <a href="#" class="btn btn-primary" id="search">검색</a>
            <span id="totalCount"></span>
          </div>
          <div
            class="row row-bottom-padded-md wrapper-restaurants-list position-relative"
          >
            <div class="loading-indicator">
              <img src="../../images/loading_restaurants.gif" />
            </div>
            <!-- <div class="col-md-3 col-sm-6 col-padding animate-box" data-animate-effect="fadeInLeft">
							<div class="blog-entry">
								<a href="#" class="blog-img"><img src="../../images/img-1.jpg" class="img-responsive" alt="Free HTML5 Bootstrap Template by FreeHTML5.co"></a>
								<div class="desc">
									<h3><a href="#">Inspirational Website</a></h3>
									<span><small>by Admin </small> / <small> Web Design </small> / <small> <i class="icon-comment"></i> 14</small></span>
									<p>Design must be functional and functionality must be translated into visual aesthetics</p>
									<a href="#" class="lead">Read More <i class="icon-arrow-right3"></i></a>
								</div>
							</div>
						</div> -->
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
